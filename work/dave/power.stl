*   Copyright 2017, David Shields
*   Licensed under the MIT license.

-include "../../setl4.stl"

    define('power(set)i,j,n,N,sub')         :(power.end)

*   Return the powerset of _set_, defined as the set of all subsets of a set.

power

    power = new('set')

*   Let _n_ be the size of _set_.
*   The powerset of the empty set is the empty set.

    n = set.size(set)
    eq(n)                                   :s(return)

*   Compute _N_ = 2 to the power _n_.

    N = 1
    i = -1

power.N

    le(i = i + 1,n)                         :f(power.N.done)
    N = N * 2
    N = N / 2                               :(power.N)

power.N.done

*   Compute the powerset as follows:

*   Loop for i = 0 ... N - 1:
*       Let _b_ be the string containing the binary value of _i_.
*       Set _this_ to the empty set.
*       Loop for _j_ = 1 ... _size(b)_
*           If the _j_-th character of _b_ is '1' then add
*           the _j_-th element of _set_ to _this_.
*       Add _this_ to the _power_.

power.next.i

    le(i = i + 1,N - 1)                     :f(power.done)
    out('power.next.i',i)
    b = binary(i)
    out('power b',show.q(b))
    j = 0

power.next.j

    le(j = j + 1,size(b))                   :f(power.j.done)
    out('power.next.j',j)
    ident(substr(b,j,1),'1') add(this,get(set,j))
                                            :(power.next.j)

power.j.done

    add(power,this)                         :(power.next.i)

power.done

    out('power done')                       :(return)
    
power.end

    define('test(set)')                   :(test.end)

test

    out()
    out('test powerset')
    out('input')
    show(set)
    out('output')
    show(power(set))
    out()
                                            :(return)

test.end

    test(new('set'))
    test(new('set a'))
    test(new('set a b'))
    test(new('set a b c'))

end

    
